<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upcoming Appointments - Bio Revive by SkinEnvy</title>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- jQuery and ZOHO SDK -->
    <script type="text/javascript" src="../../js/lib/jquery-3.3.1.min.js"></script>
    <script src="../../js/lib/ZohoEmbededAppSDK.min.js"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'theme-bg-primary': 'var(--bg-primary)',
                        'theme-bg-secondary': 'var(--bg-secondary)',
                        'theme-bg-accent': 'var(--bg-accent)',
                        'theme-text-primary': 'var(--text-primary)',
                        'theme-text-secondary': 'var(--text-secondary)',
                        'theme-border': 'var(--border-color)',
                        'theme-primary': 'var(--color-primary)',
                        'theme-secondary': 'var(--color-secondary)',
                        'theme-accent': 'var(--color-accent)',

                        primary: {
                            50: '#f8fafc', 100: '#f1f5f9', 200: '#e2e8f0', 300: '#cbd5e1', 400: '#94a3b8', 500: '#64748b', 600: '#475569', 700: '#334155', 800: '#1e293b', 900: '#0f172a',
                        },
                        success: {
                            50: '#f0fdf4', 100: '#dcfce7', 200: '#bbf7d0', 300: '#86efac', 400: '#4ade80', 500: '#22c55e', 600: '#16a34a', 700: '#15803d', 800: '#166534', 900: '#14532d',
                        },
                        warning: {
                            50: '#fff7ed', 100: '#ffedd5', 200: '#fed7aa', 300: '#fdba74', 400: '#fb923c', 500: '#f97316', 600: '#ea580c', 700: '#c2410c', 800: '#9a3412', 900: '#7c2d12',
                        },
                        danger: {
                            50: '#fef2f2', 100: '#fee2e2', 200: '#fecaca', 300: '#fca5a5', 400: '#f87171', 500: '#ef4444', 600: '#dc2626', 700: '#b91c1c', 800: '#991b1b', 900: '#7f1d1d',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    boxShadow: {
                        'card': '0 1px 3px 0 rgba(0, 0, 0, 0.1)',
                        'card-hover': '0 4px 6px -1px rgba(0, 0, 0, 0.1)',
                        'elegant': '0 2px 4px -1px rgba(0, 0, 0, 0.06)',
                    }
                }
            }
        }
    </script>

    <style>
        :root {
            /* Light Theme Variables */
            --bg-primary: #ffffff;
            --bg-secondary: #f9fafb;
            --bg-accent: #f3f4f6;
            --text-primary: #111827;
            --text-secondary: #4b5563;
            --border-color: #e5e7eb;
            --color-primary: #3b82f6;
            --color-secondary: #60a5fa;
            --color-accent: #2563eb;
        }

        html.dark {
            /* Dark Theme Variables */
            --bg-primary: #1f2937;
            --bg-secondary: #111827;
            --bg-accent: #374151;
            --text-primary: #f9fafb;
            --text-secondary: #d1d5db;
            --border-color: #374151;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .animate-fade-in { animation: fadeIn 0.6s ease-out; }
        .animate-slide-in { animation: slideIn 0.5s ease-out; }
        .animate-pulse-custom { animation: pulse 2s infinite; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.98);
            border: 1px solid rgba(226, 232, 240, 0.8);
            backdrop-filter: blur(10px);
        }
        
        html.dark .glass-effect {
            background: rgba(31, 41, 55, 0.98);
            border: 1px solid rgba(55, 65, 81, 0.8);
        }
        
        .modern-card {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }
        
        .modern-card:hover {
            box-shadow: 0 8px 25px -8px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
        }
        
        html.dark .modern-card:hover {
            box-shadow: 0 8px 25px -8px rgba(0, 0, 0, 0.4);
        }
        
        .btn-modern {
            background: var(--color-primary);
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            padding: 12px 24px;
            transition: all 0.2s ease;
        }
        
        .btn-modern:hover {
            background: var(--color-accent);
            transform: translateY(-1px);
        }
        
        .card-hover-effect {
            transition: all 0.3s ease;
        }
        
        .card-hover-effect:hover {
            box-shadow: 0 8px 25px -8px rgba(0, 0, 0, 0.15);
            transform: translateY(-3px);
        }
        
        html.dark .card-hover-effect:hover {
            box-shadow: 0 8px 25px -8px rgba(0, 0, 0, 0.4);
        }

        .loading-placeholder {
            background: linear-gradient(90deg, var(--bg-accent) 25%, var(--bg-primary) 50%, var(--bg-accent) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .status-badge {
            padding: 0.375rem 0.875rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .status-scheduled {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            color: #1e40af;
            border: 1px solid #93c5fd;
        }

        .status-confirmed {
            background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
            color: #166534;
            border: 1px solid #86efac;
        }

        .metric-card {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px -8px rgba(0, 0, 0, 0.15);
        }

        .chart-container {
            position: relative;
            height: 320px;
            width: 100%;
        }

        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .gradient-border {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 2px;
            border-radius: 16px;
        }
        
        .gradient-border-content {
            background: var(--bg-primary);
            border-radius: 14px;
        }

        .urgent-appointment {
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            border-left: 4px solid #ef4444;
        }

        html.dark .urgent-appointment {
            background: linear-gradient(135deg, rgba(220, 38, 38, 0.1) 0%, rgba(185, 28, 28, 0.1) 100%);
        }

        .today-appointment {
            background: linear-gradient(135deg, #fff7ed 0%, #ffedd5 100%);
            border-left: 4px solid #f97316;
        }

        html.dark .today-appointment {
            background: linear-gradient(135deg, rgba(249, 115, 22, 0.1) 0%, rgba(194, 65, 12, 0.1) 100%);
        }
    </style>
</head>
<body class="bg-theme-bg-secondary text-theme-text-primary font-sans antialiased min-h-screen transition-colors duration-300 hide-scrollbar">
    <div class="flex h-screen overflow-hidden">
        <!-- Modern Sidebar -->
        <div class="hidden lg:flex lg:flex-shrink-0">
            <div class="flex flex-col w-72 bg-theme-bg-primary border-r border-theme-border">
                <div class="flex items-center h-16 px-6 border-b border-theme-border">
                    <div class="flex items-center space-x-4">
                        <div class="w-10 h-10 rounded-lg bg-theme-primary flex items-center justify-center">
                            <span class="material-icons text-white text-xl">spa</span>
                        </div>
                        <div>
                            <h2 class="text-lg font-bold text-theme-text-primary">Bio Revive</h2>
                            <p class="text-xs text-theme-text-secondary">by SkinEnvy</p>
                        </div>
                    </div>
                </div>
                
                <div class="flex-1 flex flex-col pt-6 pb-4 overflow-y-auto scrollbar-hide">
                    <div class="px-6">
                        <h3 class="text-xs font-semibold uppercase tracking-wider text-theme-text-secondary mb-4">Analytics</h3>
                    </div>
                    <nav class="mt-2 flex-1 px-4 space-y-1">
                        <a href="test.html" class="group flex items-center px-4 py-3 text-sm font-medium rounded-lg text-theme-text-primary hover:bg-theme-bg-accent">
                            <span class="material-icons mr-3 text-theme-text-secondary text-xl">dashboard</span>
                            Analytics Dashboard
                        </a>
                        <a href="#" class="group flex items-center px-4 py-3 text-sm font-medium rounded-lg bg-theme-bg-accent text-theme-primary border-l-4 border-theme-primary">
                            <span class="material-icons mr-3 text-theme-primary text-xl">event</span>
                            Upcoming Appointments
                        </a>
                        <a href="past_appointments.html" class="group flex items-center px-4 py-3 text-sm font-medium rounded-lg text-theme-text-primary hover:bg-theme-bg-accent">
                            <span class="material-icons mr-3 text-theme-text-secondary text-xl">history</span>
                            Past Appointments
                        </a>
                        <a href="appointment_types.html" class="group flex items-center px-4 py-3 text-sm font-medium rounded-lg text-theme-text-primary hover:bg-theme-bg-accent">
                            <span class="material-icons mr-3 text-theme-text-secondary text-xl">spa</span>
                            Services
                        </a>
                        <a href="#" class="group flex items-center px-4 py-3 text-sm font-medium rounded-lg text-theme-text-primary hover:bg-theme-bg-accent">
                            <span class="material-icons mr-3 text-theme-text-secondary text-xl">people</span>
                            Clients
                        </a>
                        <a href="#" class="group flex items-center px-4 py-3 text-sm font-medium rounded-lg text-theme-text-primary hover:bg-theme-bg-accent">
                            <span class="material-icons mr-3 text-theme-text-secondary text-xl">analytics</span>
                            Reports
                        </a>
                    </nav>

                    <div class="px-6 mt-8">
                        <h3 class="text-xs font-semibold uppercase tracking-wider text-theme-text-secondary mb-4">Settings</h3>
                    </div>
                    <nav class="mt-2 flex-1 px-4 space-y-1">
                        <a href="#" class="group flex items-center px-4 py-3 text-sm font-medium rounded-lg text-theme-text-primary hover:bg-theme-bg-accent">
                            <span class="material-icons mr-3 text-theme-text-secondary text-xl">person</span>
                            Profile
                        </a>
                        <a href="#" class="group flex items-center px-4 py-3 text-sm font-medium rounded-lg text-theme-text-primary hover:bg-theme-bg-accent">
                            <span class="material-icons mr-3 text-theme-text-secondary text-xl">settings</span>
                            Settings
                        </a>
                        <a href="#" class="group flex items-center px-4 py-3 text-sm font-medium rounded-lg text-theme-text-primary hover:bg-theme-bg-accent">
                            <span class="material-icons mr-3 text-theme-text-secondary text-xl">help</span>
                            Help & Support
                        </a>
                    </nav>
                </div>
                
                <!-- User Profile Section -->
                <div class="p-4 border-t border-theme-border">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 rounded-lg bg-theme-primary/20 flex items-center justify-center text-theme-primary font-medium">
                            PK
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="text-sm font-medium text-theme-text-primary truncate">Prem Anand K</p>
                            <div class="flex items-center mt-1">
                                <div class="h-2 w-2 rounded-full bg-success-500 mr-2"></div>
                                <p class="text-xs text-theme-text-secondary">Online</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex flex-col flex-1 overflow-hidden">
            <!-- Top Navigation -->
            <div class="flex items-center h-16 bg-theme-bg-primary border-b border-theme-border px-4 lg:px-8">
                <button class="p-2 rounded-lg text-theme-text-secondary lg:hidden hover:bg-theme-bg-accent" onclick="toggleMobileMenu()">
                    <span class="material-icons">menu</span>
                </button>
                
                <div class="flex-1 flex justify-center lg:justify-end max-w-lg ml-auto">
                    <div class="w-full">
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <span class="material-icons text-theme-text-secondary">search</span>
                            </div>
                            <input type="text" id="searchInput" placeholder="Search by client name, service, phone..." class="block w-full pl-10 pr-4 py-2 rounded-lg border border-theme-border bg-theme-bg-accent focus:outline-none focus:ring-2 focus:ring-theme-primary focus:border-transparent text-sm text-theme-text-primary placeholder-theme-text-secondary">
                        </div>
                    </div>
                </div>
                
                <div class="ml-4 flex items-center space-x-2">
                    <button onclick="refreshUpcomingAppointments()" id="refreshBtn" class="p-2 rounded-lg text-theme-text-secondary hover:bg-theme-bg-accent" title="Refresh Appointments">
                        <span class="material-icons">refresh</span>
                    </button>
                    <button onclick="exportUpcomingAppointments()" class="p-2 rounded-lg text-theme-text-secondary hover:bg-theme-bg-accent" title="Export Report">
                        <span class="material-icons">download</span>
                    </button>
                    <button onclick="showHelpModal()" class="p-2 rounded-lg text-theme-text-secondary hover:bg-theme-bg-accent" title="Help & Information">
                        <span class="material-icons">help_outline</span>
                    </button>
                </div>
            </div>

            <!-- Page Content -->
            <main class="flex-1 overflow-auto scrollbar-hide">
                <div class="max-w-7xl mx-auto p-6 space-y-8 animate-fade-in">
                    <!-- Modern Header Section -->
                    <div class="glass-effect rounded-2xl p-6 border-l-4 border-theme-primary">
                        <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between">
                            <div class="animate-slide-in">
                                <h1 class="text-4xl font-bold bg-gradient-to-r from-theme-text-primary to-theme-text-secondary bg-clip-text text-transparent mb-3">
                                    Upcoming Appointments
                                </h1>
                                <p class="text-theme-text-secondary text-lg">Comprehensive view of your scheduled appointments</p>
                            </div>
                            <div class="mt-6 lg:mt-0">
                                <button onclick="refreshUpcomingAppointments()" class="btn-modern inline-flex items-center">
                                    <span class="material-icons text-sm mr-2">refresh</span>
                                    Refresh Data
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Enhanced Analytics Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6" id="analyticsCards">
                        <!-- Analytics cards will be populated here -->
                    </div>

                    <!-- Analytics Charts Section -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Confirmation Status Chart -->
                        <div class="modern-card rounded-xl p-6">
                            <h3 class="text-lg font-semibold text-theme-text-primary mb-6 flex items-center">
                                <span class="material-icons mr-2">verified</span>
                                Confirmation Status
                            </h3>
                            <div class="chart-container relative h-64">
                                <canvas id="confirmationStatusChart"></canvas>
                            </div>
                            <div class="mt-4 flex justify-center space-x-6">
                                <div class="flex items-center space-x-2">
                                    <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                                    <span class="text-sm text-theme-text-secondary">With Confirmation</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <div class="w-3 h-3 bg-orange-500 rounded-full"></div>
                                    <span class="text-sm text-theme-text-secondary">Without Confirmation</span>
                                </div>
                            </div>
                        </div>

                        <!-- Payment Links Chart -->
                        <div class="modern-card rounded-xl p-6">
                            <h3 class="text-lg font-semibold text-theme-text-primary mb-6 flex items-center">
                                <span class="material-icons mr-2">payment</span>
                                Payment Links
                            </h3>
                            <div class="chart-container relative h-64">
                                <canvas id="paymentLinksChart"></canvas>
                            </div>
                            <div class="mt-4 flex justify-center space-x-6">
                                <div class="flex items-center space-x-2">
                                    <div class="w-3 h-3 bg-blue-500 rounded-full"></div>
                                    <span class="text-sm text-theme-text-secondary">With Payment Link</span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <div class="w-3 h-3 bg-gray-500 rounded-full"></div>
                                    <span class="text-sm text-theme-text-secondary">Without Payment Link</span>
                                </div>
                            </div>
                        </div>

                        <!-- Upcoming Appointments Timeline -->
                        <div class="modern-card rounded-xl p-6">
                            <h3 class="text-lg font-semibold text-theme-text-primary mb-6 flex items-center">
                                <span class="material-icons mr-2">timeline</span>
                                Appointments Timeline
                            </h3>
                            <div class="chart-container relative h-64">
                                <canvas id="appointmentsTimelineChart"></canvas>
                            </div>
                        </div>

                        <!-- Service Distribution Chart -->
                        <div class="modern-card rounded-xl p-6">
                            <h3 class="text-lg font-semibold text-theme-text-primary mb-6 flex items-center">
                                <span class="material-icons mr-2">spa</span>
                                Service Distribution
                            </h3>
                            <div class="chart-container relative h-64">
                                <canvas id="serviceDistributionChart"></canvas>
                            </div>
                        </div>

                        <!-- Revenue Projection Chart -->
                        <div class="modern-card rounded-xl p-6 lg:col-span-2">
                            <h3 class="text-lg font-semibold text-theme-text-primary mb-6 flex items-center">
                                <span class="material-icons mr-2">trending_up</span>
                                Revenue Projection
                            </h3>
                            <div class="chart-container relative h-80">
                                <canvas id="revenueProjectionChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Enhanced Filters -->
                    <div class="modern-card rounded-xl p-6">
                        <h3 class="text-lg font-semibold text-theme-text-primary mb-4 flex items-center">
                            <span class="material-icons mr-2">filter_list</span>
                            Advanced Filters
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-theme-text-secondary mb-2">Date Range</label>
                                <select id="dateRangeFilter" class="w-full px-3 py-2 border border-theme-border rounded-lg focus:ring-2 focus:ring-theme-primary focus:border-transparent text-sm bg-theme-bg-secondary text-theme-text-primary">
                                    <option value="all">All Upcoming</option>
                                    <option value="today">Today</option>
                                    <option value="tomorrow">Tomorrow</option>
                                    <option value="week">This Week</option>
                                    <option value="month">This Month</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-theme-text-secondary mb-2">Service Type</label>
                                <select id="serviceFilter" class="w-full px-3 py-2 border border-theme-border rounded-lg focus:ring-2 focus:ring-theme-primary focus:border-transparent text-sm bg-theme-bg-secondary text-theme-text-primary">
                                    <option value="all">All Services</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-theme-text-secondary mb-2">Status</label>
                                <select id="statusFilter" class="w-full px-3 py-2 border border-theme-border rounded-lg focus:ring-2 focus:ring-theme-primary focus:border-transparent text-sm bg-theme-bg-secondary text-theme-text-primary">
                                    <option value="all">All Status</option>
                                    <option value="scheduled">Scheduled</option>
                                    <option value="confirmed">Confirmed</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-theme-text-secondary mb-2">Calendar</label>
                                <select id="calendarFilter" class="w-full px-3 py-2 border border-theme-border rounded-lg focus:ring-2 focus:ring-theme-primary focus:border-transparent text-sm bg-theme-bg-secondary text-theme-text-primary">
                                    <option value="all">All Calendars</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Loading State -->
                    <div id="loadingState" class="hidden">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <div class="loading-placeholder h-64 rounded-xl"></div>
                            <div class="loading-placeholder h-64 rounded-xl"></div>
                            <div class="loading-placeholder h-64 rounded-xl"></div>
                        </div>
                    </div>

                    <!-- Enhanced Appointments Grid -->
                    <div class="modern-card rounded-xl p-6">
                        <h3 class="text-lg font-semibold text-theme-text-primary mb-6 flex items-center">
                            <span class="material-icons mr-2">event</span>
                            Upcoming Appointments
                        </h3>
                        <div id="appointmentsContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <!-- Appointments will be dynamically loaded here -->
                        </div>
                    </div>

                    <!-- No Results State -->
                    <div id="noResultsState" class="hidden text-center py-12">
                        <div class="w-24 h-24 mx-auto mb-6 bg-gradient-to-br from-blue-100 to-indigo-100 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-3xl flex items-center justify-center shadow-lg">
                            <span class="material-icons text-4xl text-blue-500">search_off</span>
                        </div>
                        <h3 class="text-2xl font-bold text-theme-text-primary mb-3">No appointments found</h3>
                        <p class="text-theme-text-secondary text-lg">Try adjusting your search criteria or filters.</p>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Mobile Navigation -->
    <div id="mobileNav" class="lg:hidden fixed bottom-0 left-0 right-0 bg-theme-bg-primary border-t border-theme-border px-4 py-2 z-50">
        <div class="flex justify-around items-center">
            <a href="test.html" class="flex flex-col items-center p-2 text-theme-text-secondary">
                <span class="material-icons text-lg">dashboard</span>
                <span class="text-xs mt-1">Analytics</span>
            </a>
            <a href="#" class="flex flex-col items-center p-2 text-theme-primary">
                <span class="material-icons text-lg">event</span>
                <span class="text-xs mt-1 font-medium">Upcoming</span>
            </a>
            <a href="past_appointments.html" class="flex flex-col items-center p-2 text-theme-text-secondary">
                <span class="material-icons text-lg">history</span>
                <span class="text-xs mt-1">Past</span>
            </a>
            <a href="appointment_types.html" class="flex flex-col items-center p-2 text-theme-text-secondary">
                <span class="material-icons text-lg">spa</span>
                <span class="text-xs mt-1">Services</span>
            </a>
            <a href="#" class="flex flex-col items-center p-2 text-theme-text-secondary">
                <span class="material-icons text-lg">person</span>
                <span class="text-xs mt-1">Profile</span>
            </a>
        </div>
    </div>

    <!-- Appointment Details Modal -->
    <div id="appointmentModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-theme-bg-primary rounded-2xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto">
                <div class="p-6 border-b border-theme-border bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-t-2xl">
                    <h2 class="text-2xl font-bold text-theme-text-primary">Appointment Details</h2>
                </div>
                <div id="modalContent" class="p-6">
                    <!-- Modal content will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Theme Switcher -->
    <div id="theme-switcher-container"></div>

    <script>
        // Global variables and configuration
        let upcomingAppointments = [];
        let filteredAppointments = [];
        let originalSearchResults = [];
        let isLoading = false;
        let analyticsData = {};

        // Theme Configuration
        const themeConfig = {
            colors: {
                blue: { primary: '#3b82f6', secondary: '#60a5fa', accent: '#2563eb' },
                purple: { primary: '#8b5cf6', secondary: '#a78bfa', accent: '#7c3aed' },
                green: { primary: '#10b981', secondary: '#34d399', accent: '#059669' },
                orange: { primary: '#f97316', secondary: '#fb923c', accent: '#ea580c' },
                red: { primary: '#ef4444', secondary: '#f87171', accent: '#dc2626' },
                teal: { primary: '#14b8a6', secondary: '#5eead4', accent: '#0d9488' },
                pink: { primary: '#ec4899', secondary: '#f472b6', accent: '#db2777' },
                indigo: { primary: '#6366f1', secondary: '#818cf8', accent: '#4f46e5' }
            }
        };

        // Theme Functions
        function applyTheme(theme) {
            if (theme === 'dark') {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
            localStorage.setItem('dashboard_theme', theme);
        }

        function applyThemeColor(colorName) {
            const color = themeConfig.colors[colorName];
            if (!color) return;

            const root = document.documentElement;
            root.style.setProperty('--color-primary', color.primary);
            root.style.setProperty('--color-secondary', color.secondary);
            root.style.setProperty('--color-accent', color.accent);
            localStorage.setItem('dashboard_theme_color', colorName);
            addThemeSwitcher();
        }

        function toggleTheme() {
            const newTheme = document.documentElement.classList.contains('dark') ? 'light' : 'dark';
            applyTheme(newTheme);
            addThemeSwitcher();
        }
        
        function initializeTheme() {
            const savedTheme = localStorage.getItem('dashboard_theme') || 'light';
            const savedColor = localStorage.getItem('dashboard_theme_color') || 'blue';
            applyTheme(savedTheme);
            applyThemeColor(savedColor);
        }

        function addThemeSwitcher() {
            const container = document.getElementById('theme-switcher-container');
            if (!container) return;
            
            const currentTheme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
            const currentColor = localStorage.getItem('dashboard_theme_color') || 'blue';
            
            container.innerHTML = `
                <div class="fixed bottom-20 right-4 z-50 lg:bottom-4">
                    <div class="relative">
                        <button id="themeSwitcherButton" class="p-3 rounded-xl bg-theme-bg-primary border border-theme-border shadow-lg hover:shadow-xl transition-all duration-200">
                            <span class="material-icons text-theme-text-primary">${currentTheme === 'dark' ? 'dark_mode' : 'light_mode'}</span>
                        </button>
                        
                        <div id="themeMenu" class="hidden absolute bottom-full right-0 mb-2 w-64 bg-theme-bg-primary border border-theme-border rounded-xl shadow-xl py-2 transform opacity-0 translate-y-2 transition-all duration-300">
                            <div class="px-4 py-2 border-b border-theme-border">
                                <p class="text-sm font-medium text-theme-text-primary">Theme Settings</p>
                            </div>
                            
                            <div class="px-4 py-3">
                                <p class="text-xs font-medium text-theme-text-secondary uppercase tracking-wider mb-2">Appearance</p>
                                <div class="flex space-x-2">
                                    <button onclick="applyTheme('light')" class="flex items-center px-3 py-2 rounded-lg text-xs ${currentTheme === 'light' ? 'bg-theme-primary text-white' : 'bg-theme-bg-accent text-theme-text-primary'} transition-colors">
                                        <span class="material-icons text-sm mr-1">light_mode</span>
                                        Light
                                    </button>
                                    <button onclick="applyTheme('dark')" class="flex items-center px-3 py-2 rounded-lg text-xs ${currentTheme === 'dark' ? 'bg-theme-primary text-white' : 'bg-theme-bg-accent text-theme-text-primary'} transition-colors">
                                        <span class="material-icons text-sm mr-1">dark_mode</span>
                                        Dark
                                    </button>
                                </div>
                            </div>
                            
                            <div class="px-4 py-3 border-t border-theme-border">
                                <p class="text-xs font-medium text-theme-text-secondary uppercase tracking-wider mb-2">Colors</p>
                                <div class="grid grid-cols-4 gap-2">
                                    ${Object.entries(themeConfig.colors).map(([name, colors]) => `
                                        <button onclick="applyThemeColor('${name}')" 
                                                class="w-8 h-8 rounded-lg border-2 ${currentColor === name ? 'border-white shadow-lg' : 'border-gray-300'} transition-all"
                                                style="background-color: ${colors.primary}"
                                                title="${name.charAt(0).toUpperCase() + name.slice(1)}">
                                        </button>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // Add event listeners
            const menuButton = container.querySelector('#themeSwitcherButton');
            const themeMenu = container.querySelector('#themeMenu');

            if (menuButton && themeMenu) {
                menuButton.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const isHidden = themeMenu.classList.contains('hidden');
                    
                    if (isHidden) {
                        themeMenu.classList.remove('hidden');
                        setTimeout(() => {
                            themeMenu.classList.remove('opacity-0', 'translate-y-2');
                        }, 10);
                    } else {
                        themeMenu.classList.add('opacity-0', 'translate-y-2');
                        setTimeout(() => {
                            themeMenu.classList.add('hidden');
                        }, 300);
                    }
                });

                document.addEventListener('click', (e) => {
                    if (!themeMenu.classList.contains('hidden') && !themeMenu.contains(e.target) && !menuButton.contains(e.target)) {
                        themeMenu.classList.add('opacity-0', 'translate-y-2');
                        setTimeout(() => {
                            themeMenu.classList.add('hidden');
                        }, 300);
                    }
                });
            }
        }

        // Initialize
        document.addEventListener("DOMContentLoaded", function() {
            console.log('Initializing Upcoming Appointments...');
            initializeTheme();
            addThemeSwitcher();
            initializePage();
            
            // Try ZOHO initialization
            try {
                ZOHO.embeddedApp.init()
                    .then(function() {
                        console.log("ZOHO SDK initialized successfully");
                    })
                    .catch(function(error) {
                        console.warn("ZOHO SDK initialization failed:", error);
                    });
            } catch (error) {
                console.warn("ZOHO SDK not available:", error);
            }
        });

        // Initialize page functionality
        function initializePage() {
            loadDataFromLocalStorage();
            setupEventListeners();
            calculateAnalytics();
            renderAnalyticsCards();
            renderAnalyticsCharts();
            populateFilters();
            applyFilters();
        }

        // Load data from localStorage (NO HARDCODED DATA)
        function loadDataFromLocalStorage() {
            console.log('Loading upcoming appointments from localStorage...');
            
            try {
                const storedData = localStorage.getItem('upcomingAppointments');
                
                if (storedData) {
                    const parsedData = JSON.parse(storedData);
                    
                    if (Array.isArray(parsedData)) {
                        upcomingAppointments = parsedData;
                        console.log('Successfully loaded upcoming appointments:', upcomingAppointments.length);
                    } else {
                        console.warn('Data is not an array, initializing empty array');
                        upcomingAppointments = [];
                    }
                } else {
                    console.warn('No upcoming appointments data in localStorage, initializing empty array');
                    upcomingAppointments = [];
                }
                
                filteredAppointments = [...upcomingAppointments];
                originalSearchResults = [...upcomingAppointments];
                
            } catch (error) {
                console.error('Error loading data from localStorage:', error);
                upcomingAppointments = [];
                filteredAppointments = [];
                originalSearchResults = [];
            }
        }

        // Calculate comprehensive analytics
        function calculateAnalytics() {
            if (upcomingAppointments.length === 0) {
                analyticsData = {
                    totalAppointments: 0,
                    todayAppointments: 0,
                    tomorrowAppointments: 0,
                    weekAppointments: 0,
                    totalRevenue: 0,
                    averageRevenue: 0,
                    topServices: [],
                    confirmationStatus: {
                        withConfirmation: 0,
                        withoutConfirmation: 0
                    },
                    paymentLinks: {
                        withPaymentLink: 0,
                        withoutPaymentLink: 0
                    },
                    calendarStats: {},
                    timelineData: []
                };
                return;
            }

            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const tomorrow = new Date(today.getTime() + 24 * 60 * 60 * 1000);
            const nextWeek = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000);

            const todayAppointments = upcomingAppointments.filter(apt => {
                const aptDate = new Date(apt.datetime);
                return aptDate >= today && aptDate < tomorrow;
            });

            const tomorrowAppointments = upcomingAppointments.filter(apt => {
                const aptDate = new Date(apt.datetime);
                return aptDate >= tomorrow && aptDate < new Date(tomorrow.getTime() + 24 * 60 * 60 * 1000);
            });

            const weekAppointments = upcomingAppointments.filter(apt => {
                const aptDate = new Date(apt.datetime);
                return aptDate >= today && aptDate < nextWeek;
            });

            // Calculate revenue
            const totalRevenue = upcomingAppointments.reduce((sum, apt) => {
                return sum + parseFloat(apt.price || 0);
            }, 0);

            // Service analytics
            const serviceStats = {};
            upcomingAppointments.forEach(apt => {
                if (!serviceStats[apt.type]) {
                    serviceStats[apt.type] = { count: 0, revenue: 0 };
                }
                serviceStats[apt.type].count++;
                serviceStats[apt.type].revenue += parseFloat(apt.price || 0);
            });

            const topServices = Object.entries(serviceStats)
                .map(([name, stats]) => ({ name, ...stats }))
                .sort((a, b) => b.count - a.count)
                .slice(0, 5);

            // Confirmation and payment analytics
            const withConfirmation = upcomingAppointments.filter(apt => apt.confirmationPage).length;
            const withoutConfirmation = upcomingAppointments.length - withConfirmation;
            const withPaymentLink = upcomingAppointments.filter(apt => apt.confirmationPagePaymentLink).length;
            const withoutPaymentLink = upcomingAppointments.length - withPaymentLink;

            // Calendar distribution
            const calendarStats = {};
            upcomingAppointments.forEach(apt => {
                if (!calendarStats[apt.calendar]) {
                    calendarStats[apt.calendar] = 0;
                }
                calendarStats[apt.calendar]++;
            });

            // Timeline data for next 7 days
            const timelineData = [];
            for (let i = 0; i < 7; i++) {
                const date = new Date(today.getTime() + i * 24 * 60 * 60 * 1000);
                const dayAppointments = upcomingAppointments.filter(apt => {
                    const aptDate = new Date(apt.datetime);
                    return aptDate.toDateString() === date.toDateString();
                });
                timelineData.push({
                    date: date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' }),
                    count: dayAppointments.length,
                    revenue: dayAppointments.reduce((sum, apt) => sum + parseFloat(apt.price || 0), 0)
                });
            }

            analyticsData = {
                totalAppointments: upcomingAppointments.length,
                todayAppointments: todayAppointments.length,
                tomorrowAppointments: tomorrowAppointments.length,
                weekAppointments: weekAppointments.length,
                totalRevenue,
                averageRevenue: upcomingAppointments.length > 0 ? totalRevenue / upcomingAppointments.length : 0,
                topServices,
                confirmationStatus: {
                    withConfirmation,
                    withoutConfirmation
                },
                paymentLinks: {
                    withPaymentLink,
                    withoutPaymentLink
                },
                calendarStats,
                timelineData
            };
        }

        // Render analytics cards
        function renderAnalyticsCards() {
            const container = document.getElementById('analyticsCards');
            if (!container) return;

            const cards = [
                {
                    title: 'Total Upcoming',
                    value: analyticsData.totalAppointments,
                    icon: 'event',
                    color: 'blue',
                    subtitle: 'appointments scheduled',
                    onclick: 'clearAllFilters()'
                },
                {
                    title: 'Today',
                    value: analyticsData.todayAppointments,
                    icon: 'today',
                    color: 'orange',
                    subtitle: 'appointments today',
                    onclick: 'filterByToday()'
                },
                {
                    title: 'Tomorrow',
                    value: analyticsData.tomorrowAppointments,
                    icon: 'schedule',
                    color: 'green',
                    subtitle: 'appointments tomorrow',
                    onclick: 'filterByTomorrow()'
                },
                {
                    title: 'Expected Revenue',
                    value: `$${analyticsData.totalRevenue.toFixed(2)}`,
                    icon: 'payments',
                    color: 'emerald',
                    subtitle: 'from upcoming appointments'
                }
            ];

            container.innerHTML = cards.map(card => `
                <div class="metric-card rounded-xl p-6 ${card.onclick ? 'cursor-pointer hover:scale-105' : ''}" ${card.onclick ? `onclick="${card.onclick}"` : ''}>
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-theme-text-secondary uppercase tracking-wider">${card.title}</p>
                            <p class="text-2xl font-bold text-theme-text-primary mt-2">${card.value}</p>
                            <p class="text-xs text-theme-text-secondary mt-1">${card.subtitle}</p>
                            ${card.onclick ? '<p class="text-xs text-theme-primary mt-2 font-medium">Click to filter</p>' : ''}
                        </div>
                        <div class="w-12 h-12 bg-${card.color}-100 dark:bg-${card.color}-900/20 rounded-xl flex items-center justify-center">
                            <span class="material-icons text-${card.color}-600 text-xl">${card.icon}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Render all analytics charts
        function renderAnalyticsCharts() {
            renderConfirmationStatusChart();
            renderPaymentLinksChart();
            renderAppointmentsTimelineChart();
            renderServiceDistributionChart();
            renderRevenueProjectionChart();
        }

        // Confirmation Status Chart
        function renderConfirmationStatusChart() {
            const ctx = document.getElementById('confirmationStatusChart');
            if (!ctx) return;

            // Destroy existing chart if it exists
            if (window.confirmationStatusChartInstance) {
                window.confirmationStatusChartInstance.destroy();
            }

            window.confirmationStatusChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['With Confirmation', 'Without Confirmation'],
                    datasets: [{
                        data: [
                            analyticsData.confirmationStatus?.withConfirmation || 0,
                            analyticsData.confirmationStatus?.withoutConfirmation || 0
                        ],
                        backgroundColor: ['#22c55e', '#f97316'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = total > 0 ? ((context.raw / total) * 100).toFixed(1) : 0;
                                    return `${context.label}: ${context.raw} (${percentage}%)`;
                                }
                            }
                        }
                    },
                    cutout: '70%'
                }
            });
        }

        // Payment Links Chart
        function renderPaymentLinksChart() {
            const ctx = document.getElementById('paymentLinksChart');
            if (!ctx) return;

            // Destroy existing chart if it exists
            if (window.paymentLinksChartInstance) {
                window.paymentLinksChartInstance.destroy();
            }

            window.paymentLinksChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['With Payment Link', 'Without Payment Link'],
                    datasets: [{
                        data: [
                            analyticsData.paymentLinks?.withPaymentLink || 0,
                            analyticsData.paymentLinks?.withoutPaymentLink || 0
                        ],
                        backgroundColor: ['#3b82f6', '#6b7280'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = total > 0 ? ((context.raw / total) * 100).toFixed(1) : 0;
                                    return `${context.label}: ${context.raw} (${percentage}%)`;
                                }
                            }
                        }
                    },
                    cutout: '70%'
                }
            });
        }

        // Appointments Timeline Chart
        function renderAppointmentsTimelineChart() {
            const ctx = document.getElementById('appointmentsTimelineChart');
            if (!ctx) return;

            // Destroy existing chart if it exists
            if (window.appointmentsTimelineChartInstance) {
                window.appointmentsTimelineChartInstance.destroy();
            }

            const timelineData = analyticsData.timelineData || [];

            window.appointmentsTimelineChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: timelineData.map(d => d.date),
                    datasets: [{
                        label: 'Appointments',
                        data: timelineData.map(d => d.count),
                        borderColor: '#8b5cf6',
                        backgroundColor: 'rgba(139, 92, 246, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#8b5cf6',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            },
                            ticks: {
                                stepSize: 1
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
        }

        // Service Distribution Chart
        function renderServiceDistributionChart() {
            const ctx = document.getElementById('serviceDistributionChart');
            if (!ctx) return;

            // Destroy existing chart if it exists
            if (window.serviceDistributionChartInstance) {
                window.serviceDistributionChartInstance.destroy();
            }

            const topServices = analyticsData.topServices || [];
            const colors = ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6'];

            window.serviceDistributionChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: topServices.map(service => service.name.length > 15 ? service.name.substring(0, 15) + '...' : service.name),
                    datasets: [{
                        label: 'Appointments',
                        data: topServices.map(service => service.count),
                        backgroundColor: colors.slice(0, topServices.length),
                        borderRadius: 8,
                        borderSkipped: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                title: function(context) {
                                    const index = context[0].dataIndex;
                                    return topServices[index]?.name || '';
                                },
                                label: function(context) {
                                    return `Appointments: ${context.raw}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            },
                            ticks: {
                                stepSize: 1
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                maxRotation: 45
                            }
                        }
                    }
                }
            });
        }

        // Revenue Projection Chart
        function renderRevenueProjectionChart() {
            const ctx = document.getElementById('revenueProjectionChart');
            if (!ctx) return;

            // Destroy existing chart if it exists
            if (window.revenueProjectionChartInstance) {
                window.revenueProjectionChartInstance.destroy();
            }

            const timelineData = analyticsData.timelineData || [];

            window.revenueProjectionChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: timelineData.map(d => d.date),
                    datasets: [
                        {
                            label: 'Appointments',
                            data: timelineData.map(d => d.count),
                            backgroundColor: 'rgba(59, 130, 246, 0.6)',
                            borderColor: '#3b82f6',
                            borderWidth: 1,
                            yAxisID: 'y',
                            order: 2
                        },
                        {
                            label: 'Revenue ($)',
                            data: timelineData.map(d => d.revenue),
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            type: 'line',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            yAxisID: 'y1',
                            order: 1,
                            pointBackgroundColor: '#10b981',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 6
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 20
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    if (context.datasetIndex === 1) {
                                        return `Revenue: $${context.raw.toFixed(2)}`;
                                    }
                                    return `Appointments: ${context.raw}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Number of Appointments'
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            },
                            ticks: {
                                stepSize: 1
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Revenue ($)'
                            },
                            grid: {
                                drawOnChartArea: false
                            },
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toFixed(0);
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
        }

        // Setup event listeners
        function setupEventListeners() {
            document.getElementById('searchInput').addEventListener('input', handleSearch);
            document.getElementById('dateRangeFilter').addEventListener('change', applyFilters);
            document.getElementById('serviceFilter').addEventListener('change', applyFilters);
            document.getElementById('statusFilter').addEventListener('change', applyFilters);
            document.getElementById('calendarFilter').addEventListener('change', applyFilters);
        }

        // Populate filter dropdowns
        function populateFilters() {
            if (upcomingAppointments.length === 0) return;

            // Populate service filter
            const serviceFilter = document.getElementById('serviceFilter');
            const services = [...new Set(upcomingAppointments.map(apt => apt.type))].sort();
            serviceFilter.innerHTML = '<option value="all">All Services</option>';
            services.forEach(service => {
                const option = document.createElement('option');
                option.value = service;
                option.textContent = service;
                serviceFilter.appendChild(option);
            });

            // Populate calendar filter
            const calendarFilter = document.getElementById('calendarFilter');
            const calendars = [...new Set(upcomingAppointments.map(apt => apt.calendar))].sort();
            calendarFilter.innerHTML = '<option value="all">All Calendars</option>';
            calendars.forEach(calendar => {
                const option = document.createElement('option');
                option.value = calendar;
                option.textContent = calendar;
                calendarFilter.appendChild(option);
            });
        }

        // Handle search functionality
        function handleSearch(event) {
            const searchTerm = event.target.value.toLowerCase().trim();
            
            if (searchTerm === '') {
                filteredAppointments = [...upcomingAppointments];
            } else {
                filteredAppointments = upcomingAppointments.filter(appointment => {
                    return (
                        (appointment.firstName + ' ' + appointment.lastName).toLowerCase().includes(searchTerm) ||
                        appointment.type.toLowerCase().includes(searchTerm) ||
                        (appointment.phone && appointment.phone.toLowerCase().includes(searchTerm)) ||
                        (appointment.email && appointment.email.toLowerCase().includes(searchTerm)) ||
                        appointment.calendar.toLowerCase().includes(searchTerm)
                    );
                });
            }
            
            applyFilters();
        }

        // Apply filters
        function applyFilters() {
            const dateRange = document.getElementById('dateRangeFilter').value;
            const serviceType = document.getElementById('serviceFilter').value;
            const status = document.getElementById('statusFilter').value;
            const calendar = document.getElementById('calendarFilter').value;

            let filtered = [...filteredAppointments];

            // Date range filter
            if (dateRange !== 'all') {
                const now = new Date();
                const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                let startDate, endDate;

                switch (dateRange) {
                    case 'today':
                        startDate = new Date(today.getFullYear(), today.getMonth(), today.getDate());
                        endDate = new Date(today.getFullYear(), today.getMonth(), today.getDate() + 1);
                        break;
                    case 'tomorrow':
                        startDate = new Date(today.getFullYear(), today.getMonth(), today.getDate() + 1);
                        endDate = new Date(today.getFullYear(), today.getMonth(), today.getDate() + 2);
                        break;
                    case 'week':
                        startDate = new Date();
                        endDate = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000);
                        break;
                    case 'month':
                        startDate = new Date();
                        endDate = new Date(now.getFullYear(), now.getMonth() + 1, now.getDate());
                        break;
                }

                if (startDate && endDate) {
                    filtered = filtered.filter(apt => {
                        const aptDate = new Date(apt.datetime);
                        return aptDate >= startDate && aptDate < endDate;
                    });
                }
            }

            // Service type filter
            if (serviceType !== 'all') {
                filtered = filtered.filter(apt => apt.type === serviceType);
            }

            // Status filter
            if (status !== 'all') {
                // For upcoming appointments, we can filter by status if needed
                // This is a placeholder for future status implementation
            }

            // Calendar filter
            if (calendar !== 'all') {
                filtered = filtered.filter(apt => apt.calendar === calendar);
            }

            filteredAppointments = filtered;
            renderAppointments();
        }

        // Render appointments with improved card design
        function renderAppointments() {
            const container = document.getElementById('appointmentsContainer');
            const noResultsState = document.getElementById('noResultsState');

            if (!container) {
                console.error('Appointments container not found!');
                return;
            }

            if (filteredAppointments.length === 0) {
                container.innerHTML = '';
                if (noResultsState) noResultsState.classList.remove('hidden');
                return;
            }

            if (noResultsState) noResultsState.classList.add('hidden');

            // Sort appointments by date (soonest first)
            const sortedAppointments = filteredAppointments.sort((a, b) => 
                new Date(a.datetime) - new Date(b.datetime)
            );
            
            container.innerHTML = sortedAppointments.map((appointment, index) => {
                return createAppointmentCard(appointment, index);
            }).join('');
        }

        // Create enhanced appointment card
        function createAppointmentCard(appointment, index) {
            try {
                const appointmentDate = new Date(appointment.datetime);
                const now = new Date();
                const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                const tomorrow = new Date(today.getTime() + 24 * 60 * 60 * 1000);
                const isToday = appointmentDate >= today && appointmentDate < tomorrow;
                const isUrgent = appointmentDate.getTime() - now.getTime() < 2 * 60 * 60 * 1000 && appointmentDate > now; // Less than 2 hours away
                
                const price = parseFloat(appointment.price || 0);
                const duration = parseInt(appointment.duration || 0);
                
                let cardClass = 'modern-card card-hover-effect rounded-xl p-6 cursor-pointer animate-fade-in';
                if (isUrgent) {
                    cardClass += ' urgent-appointment';
                } else if (isToday) {
                    cardClass += ' today-appointment';
                }

                const timeDisplay = appointmentDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                const dateDisplay = appointmentDate.toLocaleDateString();
                const daysUntil = Math.ceil((appointmentDate - today) / (1000 * 60 * 60 * 24));
                
                let urgencyBadge = '';
                if (isUrgent) {
                    urgencyBadge = '<span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-300"><span class="material-icons text-xs mr-1">schedule</span>Urgent</span>';
                } else if (isToday) {
                    urgencyBadge = '<span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-800 dark:bg-orange-900/20 dark:text-orange-300"><span class="material-icons text-xs mr-1">today</span>Today</span>';
                } else if (daysUntil === 1) {
                    urgencyBadge = '<span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-300"><span class="material-icons text-xs mr-1">schedule</span>Tomorrow</span>';
                }

                return `
                    <div class="${cardClass}" onclick="showAppointmentDetails(${index})" style="animation-delay: ${index * 0.1}s">
                        <!-- Header -->
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex-1">
                                <h3 class="text-lg font-semibold text-theme-text-primary">
                                    ${appointment.firstName} ${appointment.lastName}
                                </h3>
                                <p class="text-theme-text-secondary text-sm">${appointment.type}</p>
                            </div>
                            <div class="flex flex-col items-end space-y-2">
                                ${urgencyBadge}
                                <span class="status-badge status-scheduled">Scheduled</span>
                            </div>
                        </div>

                        <!-- Date & Time -->
                        <div class="flex items-center space-x-4 mb-4 p-3 bg-theme-bg-accent rounded-lg">
                            <div class="flex items-center space-x-2">
                                <span class="material-icons text-theme-text-secondary text-sm">event</span>
                                <span class="text-sm font-medium text-theme-text-primary">${dateDisplay}</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="material-icons text-theme-text-secondary text-sm">schedule</span>
                                <span class="text-sm font-medium text-theme-text-primary">${timeDisplay}</span>
                            </div>
                            ${duration > 0 ? `
                                <div class="flex items-center space-x-2">
                                    <span class="material-icons text-theme-text-secondary text-sm">timer</span>
                                    <span class="text-sm text-theme-text-secondary">${duration}min</span>
                                </div>
                            ` : ''}
                        </div>

                        <!-- Details -->
                        <div class="space-y-3">
                            <!-- Contact Info -->
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-2">
                                    <span class="material-icons text-theme-text-secondary text-sm">phone</span>
                                    <span class="text-sm text-theme-text-secondary">${appointment.phone || 'No phone'}</span>
                                </div>
                                ${appointment.email ? `
                                    <div class="flex items-center space-x-2">
                                        <span class="material-icons text-theme-text-secondary text-sm">email</span>
                                        <span class="text-sm text-theme-text-secondary">${appointment.email}</span>
                                    </div>
                                ` : ''}
                            </div>

                            <!-- Calendar & Price -->
                            <div class="flex items-center justify-between pt-3 border-t border-theme-border">
                                <div class="flex items-center space-x-2">
                                    <span class="material-icons text-theme-text-secondary text-sm">location_on</span>
                                    <span class="text-sm text-theme-text-secondary">${appointment.calendar}</span>
                                </div>
                                ${price > 0 ? `
                                    <div class="flex items-center space-x-2">
                                        <span class="material-icons text-theme-text-secondary text-sm">payments</span>
                                        <span class="text-sm font-medium text-theme-text-primary">$${price.toFixed(2)}</span>
                                    </div>
                                ` : ''}
                            </div>
                        </div>

                        <!-- Quick Actions -->
                        <div class="flex space-x-2 mt-4 pt-4 border-t border-theme-border">
                            ${appointment.confirmationPage ? `
                                <a href="${appointment.confirmationPage}" target="_blank" onclick="event.stopPropagation();" 
                                   class="flex-1 px-3 py-2 text-sm bg-blue-100 text-blue-700 dark:bg-blue-900/20 dark:text-blue-300 rounded-lg hover:bg-blue-200 dark:hover:bg-blue-900/30 transition-colors text-center flex items-center justify-center">
                                    <span class="material-icons mr-1 text-sm">open_in_new</span>
                                    Confirmation
                                </a>
                            ` : ''}
                            ${appointment.confirmationPagePaymentLink ? `
                                <a href="${appointment.confirmationPagePaymentLink}" target="_blank" onclick="event.stopPropagation();" 
                                   class="flex-1 px-3 py-2 text-sm bg-green-100 text-green-700 dark:bg-green-900/20 dark:text-green-300 rounded-lg hover:bg-green-200 dark:hover:bg-green-900/30 transition-colors text-center flex items-center justify-center">
                                    <span class="material-icons mr-1 text-sm">payment</span>
                                    Payment
                                </a>
                            ` : ''}
                        </div>
                    </div>
                `;
            } catch (error) {
                console.error('Error creating appointment card:', error, appointment);
                return '';
            }
        }

        // Show appointment details
        function showAppointmentDetails(index) {
            const appointment = filteredAppointments[index];
            if (!appointment) return;

            const modal = document.getElementById('appointmentModal');
            const modalContent = document.getElementById('modalContent');
            
            const appointmentDate = new Date(appointment.datetime);
            const createdDate = new Date(appointment.datetimeCreated);
            
            modalContent.innerHTML = `
                <div class="p-6 border-b border-theme-border">
                    <div>
                        <h2 class="text-2xl font-bold text-theme-text-primary">${appointment.firstName} ${appointment.lastName}</h2>
                        <p class="text-theme-text-secondary">${appointment.type}</p>
                    </div>
                </div>

                <div class="p-6 space-y-6">
                    <!-- Appointment Details -->
                    <div>
                        <h3 class="text-lg font-semibold text-theme-text-primary mb-4 flex items-center">
                            <span class="material-icons mr-2">event</span>
                            Appointment Details
                        </h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <span class="text-xs font-medium text-theme-text-secondary uppercase tracking-wider">Date & Time</span>
                                <p class="text-theme-text-primary">${appointmentDate.toLocaleDateString()}</p>
                                <p class="text-theme-text-primary">${appointmentDate.toLocaleTimeString()}</p>
                            </div>
                            <div>
                                <span class="text-xs font-medium text-theme-text-secondary uppercase tracking-wider">Duration</span>
                                <p class="text-theme-text-primary">${appointment.duration} minutes</p>
                            </div>
                            <div>
                                <span class="text-xs font-medium text-theme-text-secondary uppercase tracking-wider">Calendar</span>
                                <p class="text-theme-text-primary">${appointment.calendar}</p>
                            </div>
                            <div>
                                <span class="text-xs font-medium text-theme-text-secondary uppercase tracking-wider">Price</span>
                                <p class="text-theme-text-primary">$${parseFloat(appointment.price || 0).toFixed(2)}</p>
                            </div>
                        </div>
                    </div>

                    <!-- Contact Information -->
                    <div>
                        <h3 class="text-lg font-semibold text-theme-text-primary mb-4 flex items-center">
                            <span class="material-icons mr-2">contact_phone</span>
                            Contact Information
                        </h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <span class="text-xs font-medium text-theme-text-secondary uppercase tracking-wider">Phone</span>
                                <p class="text-theme-text-primary">${appointment.phone || 'Not provided'}</p>
                            </div>
                            <div>
                                <span class="text-xs font-medium text-theme-text-secondary uppercase tracking-wider">Email</span>
                                <p class="text-theme-text-primary">${appointment.email || 'Not provided'}</p>
                            </div>
                        </div>
                    </div>

                    <!-- Additional Information -->
                    <div>
                        <h3 class="text-lg font-semibold text-theme-text-primary mb-4 flex items-center">
                            <span class="material-icons mr-2">info</span>
                            Additional Information
                        </h3>
                        <div class="bg-theme-bg-accent rounded-xl p-4 space-y-3">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <span class="text-xs font-medium text-theme-text-secondary uppercase tracking-wider">Appointment ID</span>
                                    <p class="text-theme-text-primary font-mono text-sm">${appointment.id}</p>
                                </div>
                                <div>
                                    <span class="text-xs font-medium text-theme-text-secondary uppercase tracking-wider">Created</span>
                                    <p class="text-theme-text-primary text-sm">${createdDate.toLocaleDateString()}</p>
                                    <p class="text-theme-text-secondary text-xs">${createdDate.toLocaleTimeString()}</p>
                                </div>
                            </div>
                            ${appointment.notes ? `
                                <div>
                                    <span class="text-xs font-medium text-theme-text-secondary uppercase tracking-wider">Notes</span>
                                    <p class="text-theme-text-primary text-sm">${appointment.notes}</p>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="flex space-x-3 p-6 border-t border-theme-border">
                    <button onclick="closeAppointmentModal()" class="flex-1 btn-modern bg-theme-bg-accent text-theme-text-primary hover:bg-theme-bg-primary">
                        Close
                    </button>
                    ${appointment.confirmationPage ? `
                        <a href="${appointment.confirmationPage}" target="_blank" 
                           class="flex-1 btn-modern inline-flex items-center justify-center bg-blue-600 hover:bg-blue-700">
                            <span class="material-icons mr-2 text-sm">open_in_new</span>
                            Confirmation Page
                        </a>
                    ` : ''}
                    ${appointment.confirmationPagePaymentLink ? `
                        <a href="${appointment.confirmationPagePaymentLink}" target="_blank" 
                           class="flex-1 btn-modern inline-flex items-center justify-center bg-green-600 hover:bg-green-700">
                            <span class="material-icons mr-2 text-sm">payment</span>
                            Payment Link
                        </a>
                    ` : ''}
                </div>
            `;

            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        // Close appointment modal
        function closeAppointmentModal() {
            document.getElementById('appointmentModal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        // Refresh appointments
        function refreshUpcomingAppointments() {
            if (isLoading) return;
            
            isLoading = true;
            const refreshBtn = document.getElementById('refreshBtn');
            const refreshIcon = refreshBtn.querySelector('.material-icons');
            
            // Show loading state
            refreshIcon.style.animation = 'spin 1s linear infinite';
            document.getElementById('loadingState').classList.remove('hidden');
            document.getElementById('appointmentsContainer').style.display = 'none';
            
            // Simulate refresh
            setTimeout(() => {
                loadDataFromLocalStorage();
                calculateAnalytics();
                renderAnalyticsCards();
                renderAnalyticsCharts();
                populateFilters();
                applyFilters();
                
                // Hide loading state
                refreshIcon.style.animation = '';
                document.getElementById('loadingState').classList.add('hidden');
                document.getElementById('appointmentsContainer').style.display = 'grid';
                
                isLoading = false;
                showToast('Data refreshed successfully!', 'success');
            }, 1500);
        }

        // Export upcoming appointments
        function exportUpcomingAppointments() {
            if (filteredAppointments.length === 0) {
                showToast('No appointments to export', 'warning');
                return;
            }

            const csvContent = generateCSVContent(filteredAppointments);
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', `upcoming_appointments_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showToast('Export completed successfully!', 'success');
        }

        // Generate CSV content
        function generateCSVContent(appointments) {
            const headers = [
                'ID', 'Client Name', 'Phone', 'Email', 'Service', 'Date', 'Time', 
                'Duration', 'Calendar', 'Price', 'Created Date', 'Confirmation Page'
            ];

            const csvRows = [
                headers.join(','),
                ...appointments.map(apt => [
                    apt.id,
                    `"${apt.firstName} ${apt.lastName}"`,
                    apt.phone || '',
                    apt.email || '',
                    `"${apt.type}"`,
                    apt.date,
                    apt.time,
                    apt.duration,
                    `"${apt.calendar}"`,
                    apt.price || 0,
                    apt.dateCreated,
                    apt.confirmationPage || ''
                ].join(','))
            ];

            return csvRows.join('\n');
        }

        // Navigate to confirmation page
        function openConfirmationPage(confirmationUrl) {
            if (confirmationUrl) {
                window.open(confirmationUrl, '_blank');
            } else {
                showToast('Confirmation page not available', 'warning');
            }
        }

        // Navigate to payment link
        function openPaymentLink(paymentUrl) {
            if (paymentUrl) {
                window.open(paymentUrl, '_blank');
            } else {
                showToast('Payment link not available', 'warning');
            }
        }

        // Mobile menu toggle
        function toggleMobileMenu() {
            console.log('Mobile menu toggle');
        }

        // Show help modal
        function showHelpModal() {
            // Create detailed help modal
            const helpModal = document.createElement('div');
            helpModal.id = 'helpModal';
            helpModal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50';
            
            helpModal.innerHTML = `
                <div class="flex items-center justify-center min-h-screen p-4">
                    <div class="bg-theme-bg-primary rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                        <div class="p-6 border-b border-theme-border bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-t-2xl">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-12 h-12 rounded-xl bg-blue-100 dark:bg-blue-900/20 flex items-center justify-center">
                                        <span class="material-icons text-blue-600 text-xl">help</span>
                                    </div>
                                    <div>
                                        <h2 class="text-2xl font-bold text-theme-text-primary">Help & Information</h2>
                                        <p class="text-theme-text-secondary">Upcoming Appointments Dashboard</p>
                                    </div>
                                </div>
                                <button onclick="closeHelpModal()" class="p-2 rounded-full text-theme-text-secondary hover:text-theme-text-primary hover:bg-theme-bg-accent">
                                    <span class="material-icons">close</span>
                                </button>
                            </div>
                        </div>
                        
                        <div class="p-6 space-y-6">
                            <!-- Overview Section -->
                            <div>
                                <h3 class="text-lg font-semibold text-theme-text-primary mb-4 flex items-center">
                                    <span class="material-icons mr-2 text-blue-600">dashboard</span>
                                    Dashboard Overview
                                </h3>
                                <div class="bg-theme-bg-accent rounded-xl p-4">
                                    <p class="text-theme-text-secondary mb-3">This dashboard provides a comprehensive view of your upcoming appointments with the following features:</p>
                                    <ul class="space-y-2 text-sm text-theme-text-primary">
                                        <li class="flex items-center space-x-2">
                                            <span class="w-2 h-2 bg-blue-500 rounded-full"></span>
                                            <span>Real-time view of all scheduled appointments</span>
                                        </li>
                                        <li class="flex items-center space-x-2">
                                            <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                                            <span>Smart filtering by date, service, and calendar</span>
                                        </li>
                                        <li class="flex items-center space-x-2">
                                            <span class="w-2 h-2 bg-purple-500 rounded-full"></span>
                                            <span>Quick access to confirmation page and payment links</span>
                                        </li>
                                        <li class="flex items-center space-x-2">
                                            <span class="w-2 h-2 bg-orange-500 rounded-full"></span>
                                            <span>Urgent and today appointment highlighting</span>
                                        </li>
                                    </ul>
                                </div>
                            </div>

                            <!-- Features Section -->
                            <div>
                                <h3 class="text-lg font-semibold text-theme-text-primary mb-4 flex items-center">
                                    <span class="material-icons mr-2 text-green-600">features</span>
                                    Key Features
                                </h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="bg-theme-bg-accent rounded-lg p-4">
                                        <h4 class="font-medium text-theme-text-primary mb-2 flex items-center">
                                            <span class="material-icons mr-2 text-sm">search</span>
                                            Advanced Search
                                        </h4>
                                        <p class="text-sm text-theme-text-secondary">Search by client name, service type, phone number, or email</p>
                                    </div>
                                    <div class="bg-theme-bg-accent rounded-lg p-4">
                                        <h4 class="font-medium text-theme-text-primary mb-2 flex items-center">
                                            <span class="material-icons mr-2 text-sm">filter_list</span>
                                            Smart Filters
                                        </h4>
                                        <p class="text-sm text-theme-text-secondary">Filter by today, tomorrow, this week, or custom date ranges</p>
                                    </div>
                                    <div class="bg-theme-bg-accent rounded-lg p-4">
                                        <h4 class="font-medium text-theme-text-primary mb-2 flex items-center">
                                            <span class="material-icons mr-2 text-sm">download</span>
                                            Data Export
                                        </h4>
                                        <p class="text-sm text-theme-text-secondary">Export appointment data to CSV for external use</p>
                                    </div>
                                    <div class="bg-theme-bg-accent rounded-lg p-4">
                                        <h4 class="font-medium text-theme-text-primary mb-2 flex items-center">
                                            <span class="material-icons mr-2 text-sm">schedule</span>
                                            Quick Actions
                                        </h4>
                                        <p class="text-sm text-theme-text-secondary">Access confirmation pages and payment links with one click</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Keyboard Shortcuts -->
                            <div>
                                <h3 class="text-lg font-semibold text-theme-text-primary mb-4 flex items-center">
                                    <span class="material-icons mr-2 text-indigo-600">keyboard</span>
                                    Keyboard Shortcuts
                                </h3>
                                <div class="bg-theme-bg-accent rounded-xl p-4">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                        <div class="flex items-center justify-between">
                                            <span class="text-sm text-theme-text-secondary">Refresh Data:</span>
                                            <kbd class="px-2 py-1 bg-theme-bg-primary rounded text-xs font-mono border border-theme-border">Ctrl + R</kbd>
                                        </div>
                                        <div class="flex items-center justify-between">
                                            <span class="text-sm text-theme-text-secondary">Close Modal:</span>
                                            <kbd class="px-2 py-1 bg-theme-bg-primary rounded text-xs font-mono border border-theme-border">Esc</kbd>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="p-6 border-t border-theme-border bg-theme-bg-accent rounded-b-2xl">
                            <div class="flex items-center justify-between">
                                <div class="text-sm text-theme-text-secondary">
                                    <strong>Bio Revive Upcoming Appointments</strong> - Version 2.0
                                </div>
                                <button onclick="closeHelpModal()" class="btn-modern">
                                    Got it, thanks!
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(helpModal);
            document.body.style.overflow = 'hidden';
        }

        function closeHelpModal() {
            const helpModal = document.getElementById('helpModal');
            if (helpModal) {
                document.body.removeChild(helpModal);
                document.body.style.overflow = 'auto';
            }
        }

        // Toast Notification Function
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            const bgColor = type === 'success' ? 'bg-emerald-500' : 
                           type === 'error' ? 'bg-red-500' : 
                           type === 'warning' ? 'bg-orange-500' : 'bg-blue-500';
            
            toast.className = `fixed top-4 right-4 ${bgColor} text-white px-6 py-4 rounded-xl shadow-lg z-50 transform translate-x-full transition-transform duration-300`;
            toast.innerHTML = `
                <div class="flex items-center space-x-3">
                    <span class="material-icons text-sm">${type === 'success' ? 'check_circle' : type === 'error' ? 'error' : type === 'warning' ? 'warning' : 'info'}</span>
                    <span class="font-medium">${message}</span>
                </div>
            `;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.remove('translate-x-full');
            }, 100);
            
            setTimeout(() => {
                toast.classList.add('translate-x-full');
                setTimeout(() => {
                    if (document.body.contains(toast)) {
                        document.body.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        }

        // Close modal when clicking outside
        document.addEventListener('click', function(e) {
            const appointmentModal = document.getElementById('appointmentModal');
            
            if (e.target === appointmentModal) {
                closeAppointmentModal();
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Escape key to close modals
            if (e.key === 'Escape') {
                closeAppointmentModal();
                closeHelpModal();
            }
            
            // Ctrl/Cmd + R to refresh
            if ((e.ctrlKey || e.metaKey) && e.key === 'r') {
                e.preventDefault();
                refreshUpcomingAppointments();
            }
        });

        // Add CSS for animations
        const style = document.createElement('style');
        style.textContent = `
            body, main, .overflow-y-auto, .overflow-auto {
                scrollbar-width: none;
                -ms-overflow-style: none;
            }
            body::-webkit-scrollbar, main::-webkit-scrollbar, .overflow-y-auto::-webkit-scrollbar, .overflow-auto::-webkit-scrollbar {
                display: none;
            }
            @keyframes spin {
                from { transform: rotate(0deg); }
                to { transform: rotate(360deg); }
            }
        `;
        document.head.appendChild(style);

        // Add function to filter by today
        function filterByToday() {
            // Set the date filter to today
            document.getElementById('dateRangeFilter').value = 'today';
            
            // Apply filters to show only today's appointments
            applyFilters();
            
            // Scroll to appointments section
            document.getElementById('appointmentsContainer').scrollIntoView({ 
                behavior: 'smooth',
                block: 'start'
            });
            
            // Show toast notification
            showToast(`Showing ${filteredAppointments.length} appointment(s) for today`, 'info');
        }

        // Add function to filter by tomorrow
        function filterByTomorrow() {
            // Set the date filter to tomorrow
            document.getElementById('dateRangeFilter').value = 'tomorrow';
            
            // Apply filters to show only tomorrow's appointments
            applyFilters();
            
            // Scroll to appointments section
            document.getElementById('appointmentsContainer').scrollIntoView({ 
                behavior: 'smooth',
                block: 'start'
            });
            
            // Show toast notification
            showToast(`Showing ${filteredAppointments.length} appointment(s) for tomorrow`, 'info');
        }

        // Add function to clear filters
        function clearAllFilters() {
            // Reset all filters
            document.getElementById('dateRangeFilter').value = 'all';
            document.getElementById('serviceFilter').value = 'all';
            document.getElementById('statusFilter').value = 'all';
            document.getElementById('calendarFilter').value = 'all';
            document.getElementById('searchInput').value = '';
            
            // Reset filtered appointments to show all
            filteredAppointments = [...upcomingAppointments];
            
            // Apply filters
            applyFilters();
            
            // Show toast notification
            showToast('All filters cleared', 'info');
        }
    </script>
</body>
</html>